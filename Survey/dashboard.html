<html>

	<head>
		<meta charset="UTF-8">
		
		<title>Data Science Survey</title>

		<script type="text/javascript" src="/js/jquery.min.js"></script>	
		<script type="text/javascript" src="/js/bootstrap.min.js"></script>		
		<script type="text/javascript" src="/js/d3.min.js"></script>
		<script type="text/javascript" src="/js/crossfilter.min.js"></script>
		<script type="text/javascript" src="/js/dc.min.js"></script>
		
		<link href='/css/bootstrap.min.css' rel='stylesheet' type='text/css'>
		<link href='/css/dc.css' rel='stylesheet' type='text/css'>
		<style>
			.dc-chart .axis text {
				font: 10px sans-serif;
			}			
        </style>
	</head>

	<body>
		<div class='container'>
		
			<section class="content-header">
				<h1>
                    Data Science Survey
                </h1>
            </section>
		
			<div class='row'>
				<div class='span8'>
					<div id="heatmap"></div>
				</div>
				<div class='span4'>
					<div id="row-chart"></div>
				</div>
			</div>
			
			<div class='row'>
				<div class='span12'>
					<table class='table table-hover' id='data-table'>
						<thead>
							<tr class='header'>
								<th>Practice</th>
								<th>Main Area</th>
								<th>Knowledge</th>
								<th>Data Munging</th>
								<th>Data Ingestion</th>
								<th>Visualisation</th>
								<th>Statistics</th>
								<th>Machine Learning</th>
								<th>Text Mining</th>
								<th>Big Data</th>
								<th>Python</th>
								<th>R</th>
								<th>Hadoop</th>
							</tr>
						</thead>
					</table>
				</div>
			</div>
			
		</div>
		<script type="text/javascript">
		
			// Super useful for debug in web console
			function print_filter(filter){
				var f=eval(filter);
				if (typeof(f.length) != "undefined") {}else{}
				if (typeof(f.top) != "undefined") {f=f.top(Infinity);}else{}
				if (typeof(f.dimension) != "undefined") {f=f.dimension(function(d) { return "";}).top(Infinity);}else{}
				console.log("DC DEBUG: "+filter+"("+f.length+") = "+JSON.stringify(f).replace("[","[\n\t").replace(/}\,/g,"},\n\t").replace("]","\n]"));
			}
			
			var heatmap = dc.heatMap('#heatmap');
			var dataTable = dc.dataTable("#data-table");
			var rowChart = dc.rowChart('#row-chart');

			d3.csv("data/Survey.Data.csv", function(data) {
			
				var ndx = crossfilter(data);
	
	
				areaKnowledgeDimension = ndx.dimension(function(d) {
					return [d.Area, d.Knowledge];
				});
				
				areaKnowledgeGroup = areaKnowledgeDimension.group().reduceSum(function(d) {
					return 1;
				});
				
				marginDimension = ndx.dimension(function(d) {
					return d.Area;
				});
				
				marginGroup = marginDimension.group();
				
				heatmap
					.width(800)
					.height(400)
					.margins({top: 20, left: 120, right: 10, bottom: 20})
					.dimension(areaKnowledgeDimension)
					.group(areaKnowledgeGroup)
					.title(function(d) {
						return "Count: " + d.value;
					})
					.keyAccessor(function(d) { return d.key[0]; })
					.valueAccessor(function(d) { return d.key[1]; })
					.colorAccessor(function(d) { return d.value; })
					//.colsLabel(function(d) { return "margin";})
					.colors(["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"])
					.calculateColorDomain()
					.legend(dc.legend())	;				
				
				heatmap.render();	
				
				dataTable
					.width(800)
					.height(800)
					.dimension(areaKnowledgeDimension.filter(true))
					.group(function(d) { return "Results"; })
					.size(100)
					.columns([
						function(d) { return d.Practice; },
						function(d) { return d.Area; },
						function(d) { return d.Knowledge; },
						function(d) { return d.Data_Munging; },
						function(d) { return d.Data_Ingestion; },
						function(d) { return d.Visualisation; },
						function(d) { return d.Statistics; },
						function(d) { return d.Machine_Learning; },
						function(d) { return d.Text_Mining; },
						function(d) { return d.Big_Data; },
						function(d) { return d.Python; },
						function(d) { return d.R; },
						function(d) { return d.Hadoop; }
					])
					/*.sortBy(function(d) { return d.key })
					.order(d3.ascending);*/				
				dataTable.render();
				
			/*	print_filter(marginGroup);
				/*
				rowChart
					.width(300)
					.height(400)
					//.margins({top: 20, left: 10, right: 10, bottom: 20})
					.dimension(marginDimension)
					.group(marginGroup)
					.valueAccessor(function(d) {
						var perc = (d.value / 8000) * 100;
						console.log(perc);
						return perc;
					})
					.label(function (d) {
						return d.key;
					})
					.title(function(d) {
						return ((d.value / 8000) * 100).toFixed(2);
					})
					//.x(d3.scale.linear().domain([0, 100]).range([0, 200]))
					.ordinalColors(['#3182bd', '#6baed6', '#9ecae1', '#c6dbef', '#dadaeb'])
					.ordering(function(d) { return -d.key })
					.xAxis().ticks(5).tickFormat(function (v) { return v + '%'; });
					//.ordering(function(d) { return d.value });
				
				rowChart.render();
				*/
				dc.renderAll();
				
			});
		</script>
	</body>
</html>